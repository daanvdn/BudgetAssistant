<h2 mat-dialog-title class="dialog-title">Zoek transacties</h2>

<div mat-dialog-content class="dialog-content">
  <!-- Transaction Type & Amount Row -->
  <section class="filter-section">
    <div class="section-header">Transactie type</div>
    <div class="form-row three-columns">
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Type</mat-label>
        <mat-select [formControl]="transactionTypeControl" placeholder="in- & uitkomsten">
          @for (option of transactionTypeOptions; track option.value) {
            <mat-option [value]="option.value">{{ option.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Min. bedrag</mat-label>
        <input matInput type="number" [formControl]="minAmountControl" placeholder="0.00">
        <span matTextPrefix>€&nbsp;</span>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Max. bedrag</mat-label>
        <input matInput type="number" [formControl]="maxAmountControl" placeholder="0.00">
        <span matTextPrefix>€&nbsp;</span>
      </mat-form-field>
    </div>
  </section>

  <!-- Period Selection Row -->
  <section class="filter-section">
    <div class="section-header">Periode</div>
    <div class="form-row two-columns">
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Snelkoppeling</mat-label>
        <mat-select [formControl]="periodShortcutControl" placeholder="Selecteer periode">
          @for (option of periodShortcutOptions; track option.value) {
            <mat-option [value]="option.value">{{ option.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field date-range-field">
        <mat-label>Datum bereik</mat-label>
        <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
          <input matStartDate placeholder="Start" formControlName="start">
          <input matEndDate placeholder="Eind" formControlName="end">
        </mat-date-range-input>
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>
      </mat-form-field>
    </div>
  </section>

  <!-- Category Selection -->
  <section class="filter-section">
    <div class="section-header">Categorie</div>
    <div class="form-row single-column">
      <app-category-tree-dropdown
        class="category-dropdown"
        (selectionChange)="handleCategorySelectionChange($event)"
        [selectedCategoryQualifiedNameStr]="'DUMMY CATEGORIE'"
        [transactionTypeEnum]="transactionTypeForCategory">
      </app-category-tree-dropdown>
    </div>
  </section>

  <!-- Counterparty Selection -->
  <section class="filter-section">
    <div class="section-header">Tegenpartij</div>
    <div class="form-row two-columns">
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Naam tegenpartij</mat-label>
        <input matInput
               type="text"
               [formControl]="counterpartyNameControl"
               [matAutocomplete]="autoName"
               placeholder="Zoek op naam">
        <mat-autocomplete #autoName="matAutocomplete">
          @for (name of filteredCounterpartyNames$ | async; track name) {
            <mat-option [value]="name">{{ name }}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Rekening tegenpartij</mat-label>
        <input matInput
               type="text"
               [formControl]="counterpartyAccountControl"
               [matAutocomplete]="autoAccount"
               placeholder="Zoek op rekening">
        <mat-autocomplete #autoAccount="matAutocomplete">
          @for (account of filteredCounterpartyAccounts$ | async; track account) {
            <mat-option [value]="account">{{ account }}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>
    </div>
  </section>

  <!-- Transaction/Communication Search -->
  <section class="filter-section">
    <div class="section-header">Transactie / Mededelingen</div>
    <div class="form-row single-column">
      <mat-form-field appearance="outline" class="form-field full-width">
        <mat-label>Zoektekst</mat-label>
        <input matInput
               type="text"
               [formControl]="communicationTextControl"
               placeholder="Zoek in transactie of mededelingen">
      </mat-form-field>
    </div>
  </section>
</div>

<div mat-dialog-actions class="dialog-actions">
  @if (showValidationError) {
    <div class="validation-error">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <span>Selecteer minimaal één zoekcriterium</span>
    </div>
  }
  <div class="action-buttons">
    <button mat-button class="cancel-button" (click)="onCancelClick()">Annuleer</button>
    <button mat-flat-button color="primary" class="search-button" (click)="onSearchClick()">Zoek</button>
  </div>
</div>
